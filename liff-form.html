// LIFF 表單頁面 (liff-form.html) 中的 JavaScript
// 確保您已載入 liff-sdk
window.onload = function() {
    liff.init({
        liffId: 'YOUR_LIFF_ID' // 替換為您的 LIFF ID
    }).then(() => {
        if (!liff.isLoggedIn()) {
            liff.login(); // 如果未登入，引導登入
            return;
        }

        // 1. 自動取得 LINE 使用者資訊 (姓名、ID)
        const idToken = liff.getIDToken();
        if (!idToken) {
            alert('無法取得使用者 ID 令牌，請檢查 Scope 設定。');
            return;
        }
        
        liff.getProfile().then(profile => {
            document.getElementById('user_name').value = profile.displayName;
            document.getElementById('user_id').value = profile.userId;
        }).catch(err => console.error(err));

    }).catch((err) => {
        console.error("LIFF 初始化失敗", err);
    });
}

// 提交表單的函式
function submitRegistration() {
    const data = {
        line_user_id: document.getElementById('user_id').value,
        name: document.getElementById('user_name').value,
        participants: document.getElementById('participants').value, // 下拉式選單值
        guest_name: document.getElementById('guest_name').value, // 文字輸入
        // 讀取從 Google Sheet 取得的活動主旨等 (如果需要顯示)
    };

    fetch('YOUR_BACKEND_API_ENDPOINT/register', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify(data),
    })
    .then(response => response.json())
    .then(result => {
        alert(result.message);
        if (result.success) {
            liff.closeWindow(); // 成功後關閉 LIFF 視窗
        }
    })
    .catch((error) => {
        console.error('提交失敗:', error);
        alert('報名提交失敗，請重試！');
    });
}
