<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ä¸»è¾¦è€…ç®¡ç†å¾Œå°</title>
  <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
  <style>
    body { font-family: sans-serif; background: #eef2f3; padding: 20px; }
    .box { background: white; padding: 20px; border-radius: 15px; max-width: 500px; margin: auto; box-shadow: 0 4px 10px rgba(0,0,0,0.1); }
    input { width: 100%; padding: 10px; margin: 10px 0; border: 1px solid #ddd; border-radius: 8px; }
    .btn { width: 100%; padding: 12px; background: #06C755; color: white; border: none; border-radius: 8px; font-weight: bold; cursor: pointer; }
    .item { border-bottom: 1px solid #eee; padding: 10px 0; display: flex; justify-content: space-between; align-items: center; }
  </style>
</head>
<body>
<div class="box">
  <h2>â• å»ºç«‹æ–°æ´»å‹•</h2>
  <input type="text" id="title" placeholder="æ´»å‹•åç¨±">
  <label>æ´»å‹•æ™‚é–“</label><input type="datetime-local" id="time">
  <label>å ±åé–‹å§‹</label><input type="datetime-local" id="open">
  <label>å ±åæˆªæ­¢</label><input type="datetime-local" id="close">
  <input type="text" id="venue" placeholder="å ´åœ°åç¨±">
  <input type="text" id="address" placeholder="åœ°å€">
  <button class="btn" onclick="create()">ç™¼ä½ˆæ´»å‹•</button>

  <h2 style="margin-top:30px;">ğŸ“‹ æˆ‘å»ºç«‹çš„æ´»å‹•</h2>
  <div id="list">è®€å–ä¸­...</div>
</div>

<script>
const GAS_URL = 'ä½ çš„GASéƒ¨ç½²URL';
const LIFF_ID = 'ä½ çš„ç®¡ç†å“¡LIFF_ID';
let ADMIN_UID, ADMIN_NAME;

async function init() {
  await liff.init({ liffId: LIFF_ID });
  if (!liff.isLoggedIn()) { liff.login(); return; }
  const p = await liff.getProfile();
  ADMIN_UID = p.userId; ADMIN_NAME = p.displayName;
  loadMyEvents();
}

async function create() {
  const payload = {
    action: 'createEvent', adminUid: ADMIN_UID, adminNickname: ADMIN_NAME,
    title: document.getElementById('title').value,
    time: document.getElementById('time').value,
    openTime: document.getElementById('open').value,
    closeTime: document.getElementById('close').value,
    venueName: document.getElementById('venue').value,
    address: document.getElementById('address').value
  };
  await fetch(GAS_URL, { method: 'POST', body: JSON.stringify(payload) });
  alert('å»ºç«‹æˆåŠŸ'); location.reload();
}

async function loadMyEvents() {
  const res = await fetch(`${GAS_URL}?action=getMyEvents&adminUid=${ADMIN_UID}`);
  const data = await res.json();
  const div = document.getElementById('list');
  div.innerHTML = '';
  data.events.forEach(e => {
    div.innerHTML += `
      <div class="item">
        <div><b>${e.Title}</b><br><small>${new Date(e.Time).toLocaleDateString()}</small></div>
        <button onclick="del('${e.EventID}')" style="color:red; border:none; background:none; cursor:pointer;">ğŸ—‘ï¸ åˆªé™¤</button>
      </div>`;
  });
}

async function del(id) {
  if(!confirm('ç¢ºå®šåˆªé™¤ï¼Ÿ')) return;
  await fetch(GAS_URL, { method: 'POST', body: JSON.stringify({ action: 'deleteEvent', eventId: id, adminUid: ADMIN_UID }) });
  loadMyEvents();
}

init();
</script>
</body>
</html>
